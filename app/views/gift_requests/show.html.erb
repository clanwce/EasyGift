<script type="text/javascript">
  // You probably don't want to use globals, but this is just example code
  var fbAppId = '563804037067616';
  var objectToLike = 'http://easy-gift.herokuapp.com/gift_requests';

  // This check is just here to make sure you set your app ID. You don't
  // need to use it in production. 
  if (fbAppId === 'replace me') {
    alert('Please set the fbAppId in the sample.');
  }

  /*
   * This is boilerplate code that is used to initialize
   * the Facebook JS SDK.  You would normally set your
   * App ID in this code.
   */

  // Additional JS functions here
  window.fbAsyncInit = function() {
    FB.init({
      appId      : fbAppId, // App ID
      status     : true,    // check login status
      cookie     : true,    // enable cookies to allow the
                            // server to access the session
      xfbml      : true,     // parse page for xfbml or html5
                            // social plugins like login button below
      version        : 'v2.0',  // Specify an API version
    });

    // Put additional init code here
  };

  // Load the SDK Asynchronously
  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));

  /*
   * This function makes a call to the og.likes API.  The
   * object argument is the object you like.  Other types
   * of APIs may take other arguments. (i.e. the book.reads
   * API takes a book= argument.)
   *
   * Because it's a sample, it also sets the privacy
   * parameter so that it will create a story that only you
   * can see.  Remove the privacy parameter and the story
   * will be visible to whatever the default privacy was when
   * you added the app.
   *
   * Also note that you can view any story with the id, as
   * demonstrated with the code below.
   *
   * APIs used in postLike():
   * Call the Graph API from JS:
   *   https://developers.facebook.com/docs/reference/javascript/FB.api
   * The Open Graph og.likes API:
   *   https://developers.facebook.com/docs/reference/opengraph/action-type/og.likes
   * Privacy argument:
   *   https://developers.facebook.com/docs/reference/api/privacy-parameter
   */

  function postLike() {
    FB.api(
       'https://graph.facebook.com/me/easy-gift:post',
       'post',
       { gift_request: objectToLike,
         privacy: {'value': 'SELF'} },
       function(response) {
         if (!response) {
           alert('Error occurred.');
         } else if (response.error) {
           document.getElementById('result').innerHTML =
             'Error: ' + response.error.message;
         } else {
           document.getElementById('result').innerHTML =
             '<a href=\"https://www.facebook.com/me/activity/' +
             response.id + '\">' +
             'Story created.  ID is ' +
             response.id + '</a>';
         }
       }
    );
  }
</script>

<!--
  Login Button

  https://developers.facebook.com/docs/reference/plugins/login

  This example needs the 'publish_actions' permission in
  order to publish an action.  The scope parameter below
  is what prompts the user for that permission.
-->

<div
  class="fb-login-button"
  data-show-faces="true"
  data-width="200"
  data-max-rows="1"
  data-scope="publish_actions">
</div>

<div>
This example creates a story on Facebook using the
<a href="https://developers.facebook.com/docs/reference/ogaction/og.likes">
<code>og.likes</code></a> API.  That story will just say
that you like an
<a href="http://techcrunch.com/2013/02/06/facebook-launches-developers-live-video-channel-to-keep-its-developer-ecosystem-up-to-date/">
article on TechCrunch</a>.  The story should only
be visible to you.
</div>

<div>
<input
  type="button"
  value="Create a story with an og.likes action"
  onclick="postLike();">
</div>

<div id="result"></div>



<style type="text/css">
.scroll
{
width: 400px;
height: 80px;
overflow:auto;
word-wrap:break-word;
}

.btn-class
{
background-color:#EEEEEE;
}
</style>

<div class="container">
<div align = "center">
		<div class="inline">
		<p id="notice" style="color:red"><%= notice %></p>
		</div>
</div>

  <%= render 'subnav' %>
  <script type="text/javascript">
    var node = document.getElementById("subnav").getElementsByTagName("li")[0];
  node.setAttribute("class", "active");
  </script>


<div style="display:inline"> 

<div style="text-align: center;">
		<div style="width: 500px; margin: 0 auto;" class="inline">
			<h3 > <%= @gift_request.title %> </h3>
			<h3> Views: <%= @gift_request.views %> </h3>
		<h5 class="inline"> Created By: <%= @gift_request.username %> </h5><br/> 
		<%= link_to 'Edit Gift Request', edit_gift_request_path(@gift_request), :class => "btn-link",:style => "color:blue" %>
		<%= link_to image_tag('/images/Facebook-icon.png', height: '20', width: '20'), 'http://www.facebook.com/sharer.php?u=http%3A%2F%2Feasy-gift.herokuapp.com/gift_requests/' + @gift_request.id.to_s, :target => :blank %>
		</div>

</div>
 <div class="inline container " data-id=titlea >
        	<h5 class="scroll" style="margin-left:6%;width: 1000px;height: auto"> Description:  <%= @gift_request.description %> 
      </h5>
      </div>

<div class="inline" style="margin-left:6%;">
		<form action="/likes/create" method="post" class="inline">
		<input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>" />
	    <input type="hidden" name="like[user_id]" value="<%= current_user.id %>" />
	    <input type="hidden" name="like[gift_request_id]" value="<%= @gift_request.id %>" />
	    <input type="hidden" name="like[status]" value="like" />
	    <button type="submit" class="btn btn-class"><%= image_tag 'like.png', :class=>"inline " , :alt => 'lgo', width:"20",   height:"20" %></button>
		</form>
		<form action="/likes/create" method="post" class="inline">
		<input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>" />
	    <input type="hidden" name="like[user_id]" value="<%= current_user.id %>" />
	    <input type="hidden" name="like[gift_request_id]" value="<%= @gift_request.id %>" />
	    <input type="hidden" name="like[status]" value="dislike" />
	    <button type="submit" class="btn btn-class"><%= image_tag 'dislike.png', :class=>"inline " , :alt => 'lgo', width:"20",   height:"20" %></button>
		</form>
		
	<% if @gift_request.like_count > 0 %>	
	<button type="submit" class="btn btn-success btn-xs" data-toggle="modal" data-target="#likemodal" > <%= @gift_request.like_count %> People Liked</button>
		<% end %>
		
		<% if @gift_request.dislike_count > 0 %>
	 <button type="submit" class="btn btn-danger btn-xs" data-toggle="modal" data-target="#dislikemodal" > <%= @gift_request.dislike_count %> People disliked</button>
		<% end %>

      </div>

		</div>
     
</div>

<div style="width: 1000px; margin: 0 auto;">

<br><br>
<div class="inline btn-link "> Tags 
		<% if @gift_request_tags %>
			<% @gift_request_tags.each do |tag| %>
		
			<%= link_to tag.name, {:controller => "tags",:action => "show", :id => tag.id}, :class => "inline btn btn-link",:style => "display:inline" ,:method => :get %>

			<% end %>
		<% end %>
	</div>

<!-- Like Modal -->
<div class="modal fade" id="likemodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">People who liked this </h4>
      </div>
      <div class="modal-body" style="overflow:auto" >
      	<table class="table ">
		<% if @gift_request_likes %>
			<% @gift_request_likes.each do |like| %>
			<% if like.status=="like" %>
			<tr >
				<td>
				<div class="inline">
					<div style="background-color:#008080;width:45%">
					<%= image_tag 'user.png', :alt => 'lgo', width:"80",   height:"80", :class => "inline" %>
					 
					 <%= button_to [like.username], {:controller => "users",:action => "show", :id => like.user_id}, :class => "inline btn", :method => :get %>
				</div>
				</div>
				</td>
			</tr>
				<% end %>

			<% end %>
		<% end %>
	</table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!--Dis-Like Modal -->
<div class="modal fade" id="dislikemodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">People who disliked this </h4>
      </div>
      <div class="modal-body" style="overflow:auto" >
      	<table class="table ">

			<% if @gift_request_likes %>
				<% @gift_request_likes.each do |like| %>
					<% if like.status=="dislike" %>
				
				<tr >
					<td>
					<div class="inline">
						<div style="background-color:#008080;width:45%">
						<%= image_tag 'user.png', :alt => 'lgo', width:"80",   height:"80", :class => "inline" %>
						 
						 <%= button_to [like.username], {:controller => "users",:action => "show", :id => like.user_id}, :class => "inline btn ", :method => :get %>
					</div>
					</div>
					</td>
				</tr>
					<% end %>

				<% end %>
			<% end %>
		</table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


<hr style="background-color: #000;height: 1px;"> 
 <div class="commentscontainer inline">
<h4> <b>Comments </b> </h4>
<!-- Nav tabs -->
<ul class="nav nav-tabs">
  <li class="active"><a href="#date" data-toggle="tab">Date</a></li>
  <li><a href="#popular" data-toggle="tab">Popular</a></li>
 </ul>


<div class="tab-content">
  <div class="tab-pane fade in active" id="date">
		
		<% if @gift_request_comments %> 
			<% @gift_request_comments.each do |comment| %>
		<b><%= comment.created_at.strftime("%b %d, %Y %H:%M") %></b><br>
			<p class="scroll" style="width:80;height:auto"%><%= comment.description %>
		</p>	
			<% if comment.final_answer %>
				<b> FINAL ANSWER </b>
			<% end %>
			
		<!-- </p> -->

	<div align="right"><b><a href="/users/<%= comment.user_id %>"> <%= comment.username %></a><br>Rank: <%= comment.user.rank %> Points: <%= comment.user.points %> </b> </div>

	<form action="/likes/create" method="post" class="inline">
		<input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>" />
	    <input type="hidden" name="like[user_id]" value="<%= current_user.id %>" />
	    <input type="hidden" name="like[comment_id]" value="<%= comment.id %>" />
	    <input type="hidden" name="like[status]" value="like" />
	    <button type="submit" class="btn btn-class inline"><%= image_tag 'like.png', :class=>"inline " , :alt => 'lgo', width:"15",   height:"15" %></button>
	</form>
	<form action="/likes/create" method="post"  class="inline">
		<input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>" />
	    <input type="hidden" name="like[user_id]" value="<%= current_user.id %>" />
	    <input type="hidden" name="like[comment_id]" value="<%= comment.id %>" />
	    <input type="hidden" name="like[status]" value="dislike" />
	    <button type="submit" class="btn btn-class inline"><%= image_tag 'dislike.png', :class=>"inline " , :alt => 'lgo', width:"15",   height:"15" %></button>
	    <!-- <button type="submit" class="btn btn-danger btn-xs">Dislike</button> -->
	</form>
	
	<form action="/comments/final" method="post" class="inline">
			<input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>" />
		    <input type="hidden" name="comment_id" value="<%= comment.id %>" />
		   <button type="submit" class="btn btn-class inline"><%= image_tag 'check.png', :class=>"inline " , :alt => 'lgo', width:"15",   height:"15" %></button>
		</form>

		<% if comment.like_count > 0 %>	
		<button type="submit" class="btn btn-success btn-xs" id="<%= comment.id %>" onclick="onclickbttn(this,'like')" data-toggle="modal" data-target="#commentlikemodal" > <%= comment.like_count %> People Liked</button>
		<% end %>

		<% if comment.dislike_count > 0 %>	
		 <button type="submit" class="btn btn-danger btn-xs"  id="<%= comment.id %>" onclick="onclickbttn(this,'dislike')" data-toggle="modal" data-target="#commentdislikemodal" > <%= comment.dislike_count %> People disliked</button>
		<% end %>


 <hr style="background-color: #C0C0C0;height: 1px;"> 

	<% end %>
<% end %>

  </div>

<!-- Comment Like Modal -->
<div class="modal fade" id="commentlikemodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">People who liked this </h4>
      </div>
      <div class="modal-body" style="overflow:auto" id="likecommentbody">
      	<table class="table" id="liketable">
	</table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Comment Dis-Like Modal -->
<div class="modal fade" id="commentdislikemodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">People who disliked this </h4>
      </div>
      <div class="modal-body">
      	<table class="table" id="disliketable">
		</table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

  <div class="tab-pane fade" id="popular">

		 <% gift_request_cc = @gift_request_comments.sort_by(&:like_count) %>
		 <% @gift_request_comments = gift_request_cc.reverse %>
		
		 <% if @gift_request_comments %> 
			<% @gift_request_comments.each do |comment| %>

		<b><%= comment.created_at.strftime("%b %d, %Y %H:%M") %></b><br>
			<p class="scroll" style="width:80%;height:auto"><%= comment.description %>
			</p>	
			<% if comment.final_answer %>
				<b> FINAL ANSWER </b>
			<% end %>
				
		<!-- </p> -->

	<div align="right"><b><a href="/users/<%= comment.user_id %>"> <%= comment.username %></a><br>Rank: <%= comment.user.rank %> Points: <%= comment.user.points %> </b> </div>

	<form action="/likes/create" method="post" class="inline">
		<input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>" />
	    <input type="hidden" name="like[user_id]" value="<%= current_user.id %>" />
	    <input type="hidden" name="like[comment_id]" value="<%= comment.id %>" />
	    <input type="hidden" name="like[status]" value="like" />
	    <button type="submit" class="btn btn-class inline"><%= image_tag 'like.png', :class=>"inline " , :alt => 'lgo', width:"15",   height:"15" %></button>
	</form>
	<form action="/likes/create" method="post"  class="inline">
		<input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>" />
	    <input type="hidden" name="like[user_id]" value="<%= current_user.id %>" />
	    <input type="hidden" name="like[comment_id]" value="<%= comment.id %>" />
	    <input type="hidden" name="like[status]" value="dislike" />
	    <button type="submit" class="btn btn-class inline"><%= image_tag 'dislike.png', :class=>"inline " , :alt => 'lgo', width:"15",   height:"15" %></button>
	    <!-- <button type="submit" class="btn btn-danger btn-xs">Dislike</button> -->
	</form>
	
	<form action="/comments/final" method="post" class="inline">
			<input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>" />
		    <input type="hidden" name="comment_id" value="<%= comment.id %>" />
		   <button type="submit" class="btn btn-class inline"><%= image_tag 'check.png', :class=>"inline " , :alt => 'lgo', width:"15",   height:"15" %></button>
		</form>

		<% if comment.like_count > 0 %>	
		<button type="submit" class="btn btn-success btn-xs" id="<%= comment.id %>" onclick="onclickbttn(this,'like')" data-toggle="modal" data-target="#commentlikemodal" > <%= comment.like_count %> People Liked</button>
		<% end %>

		<% if comment.dislike_count > 0 %>	
		 <button type="submit" class="btn btn-danger btn-xs"  id="<%= comment.id %>" onclick="onclickbttn(this,'dislike')" data-toggle="modal" data-target="#commentdislikemodal" > <%= comment.dislike_count %> People disliked</button>
		<% end %>


 <hr style="background-color: #C0C0C0;height: 1px;"> 

	<% end %>
<% end %>

  </div>

 </div>

	
<br>

 <form action="/comments" method="post">
    <label>Make a Comment:</label><br>  
    <input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>" />
    <input type="hidden" name="comment[user_id]" value="<%= current_user.id %>" >
    <input type="hidden" name="comment[gift_request_id]" value="<%= @gift_request.id %>">
    <textarea name="comment[description]" id="newcomment" rows="4" cols="50">
    </textarea>
		<br>
    <input type="submit" value="Submit">
 </form>

</div>
</div>

<!-- <%= link_to 'Back', gift_requests_path %>
-->